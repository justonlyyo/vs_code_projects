# 组织架构,人员和权限模块接口

## 组织架构

需要以下接口

* 添加集团信息
* 修改集团信息
* 删除集团信息

* 添加酒店(同级部门)信息
* 修改酒店(同级部门)信息
* 删除酒店(同级部门)信息

* 添加部门信息
* 修改部门信息(注意部门间层级关系可能的变更)
* 删除部门信息

## 人员

* 添加人员信息
* 编辑人员信息
* 删除人员信息

人员信息包含:

* 姓名,联系方式等基本信息
* 岗位信息
* 部门信息
* 权限组信息

## 权限

权限的设置分三级:

* **业务权限**: 最低一级是单个独立的业务的权限(比如查看用户信息, 添加用户信息等).业务权限不开放给酒店.只有超级管理员有操作权限.
* **权限组**: 中间一级是数个逻辑上有内聚性的业务的权限组成的权限组.(比如用户管理权限, 财务管理权限等).权限组的管理一般不开放给酒店.但是可以考虑增加一个开关,必要时向指定酒店开放此权限.
* **角色**: 最上面一级是角色. 角色是由数个权限组组合而成.(比如系统管理员, 前台人员, 客房部经理等).角色的管理一般开放给酒店.如果酒店不自行设置的话,系统应该能提供一套默认的角色供酒店的管理人员选择

### 业务权限

业务权限用唯一的url和权限的值(0/1)来表示.业务权限的添加和移除理论上由系统自动完成的(系统的自动机制另行讨论)

* 添加业务权限
* 移除业务权限

### 权限组

* 添加权限组
* 编辑权限组(修改权限组关联的业务权限和权限值)
* 删除权限组

### 角色

* 添加角色
* 编辑角色
* 移除角色

### 员工登录

现阶段已知的登录方式:

* 用户名密码 
* 手机验证码
* 微信扫码
* 人脸识别
* 工号卡刷卡

> 目前优先制作用户名密码登录, 手机登录和微信登录  2019-1-30

身份验证的机制详见 NewISpider系统前后端接口约定.md

本部分目前需要实现的接口是

* 用户名/密码方式的登录接口
* 短信验证方式的登录接口
* 威信登录方式的登录接口
* token的验证接口
* token的分发接口(用户请求成功后,重新分配一个token给用户)

#### 登录机制

##### 用户名密码登录

* 用户打开登录页面, 输入酒店id, 用户名和密码, 选择班次.然后提交. 本步骤提交的参数包括:

|参数名|数据类型|含义|说明|
|:--:|:--:|:--:|:--:|
|account|string|账户名|登录账户名|
|password|string|账户密码|不可明文传输|
|hotel_id|int|酒店id|酒店的唯一id|
|schedule_id|int|排班的id|早班,中班,晚班|

##### 手机验证码登录

业务逻辑如下:

* 输入手机号码.点击发送验证码按钮.
* 前端先验证手机号码是否合法.合法就发送一个请求登录验证码的request到后端的短信接口. 发送request包含的参数:

|参数名|数据类型|含义|说明|
|:--:|:--:|:--:|:--:|
|phone|string|手机号码|登录用户的手机号码,全局唯一|
|hotel_id|int|酒店id|酒店的唯一id|
|schedule_id|int|排班的id|早班,中班,晚班|

* 后端接受到此request后,检查手机号码是否归属本酒店员工. 是则发送一个登录验证码.
* 用户在收到短信验证码后,在页面填入短信验证码.点击登录按钮进行登录.登录成功后,短信验证码即失效. 用户登录的时候提交的参数包括:

|参数名|数据类型|含义|说明|
|:--:|:--:|:--:|:--:|
|phone|string|手机号码|登录用户的手机号码,全局唯一|
|hotel_id|int|酒店id|酒店的唯一id|
|sms_code|string|短信验证码|可设置有效期|
|schedule_id|int|排班的id|早班,中班,晚班|

* 短信验证码15-30分钟的超时失效.
* 注意短信验证码有一定概率发送失败

##### 微信扫码登录

##### 人脸识别登录

##### 工号卡刷卡登录

