#一般性约定

-----

> version: 0.0.3

本文档描述的是 NewISpider系统 的**前端页面和后端接口**之间的通讯方式. 后端各个模块之间的调用,不在本文档描述范围内.

本约定的内容旨在降低出错可能性及提高开发速度.非强制性约束.

## 更新

### 2019-2-25

* 合并参数规范和url拼接规范
* 补充修正返回约定

## 约定内容

### 协议

调试状态下可以使用http协议.生产环境请使用https替代

### 请求方法

查询请求(包含:查询单条记录,查询所有记录, 查询一组记录等)使用get的请求方法.
提交(添加), 修改和删除请求使用post的请求方式

### url拼接

url拼接的目的在于快速理解接口含义.约束前后段接口命名一致性.及降低前后端沟通成本.

#### 查询请求

拼接方式为: 版本号/app名/模块名/业务名.以下图为例:
	$$ \text{/v1/customer/member/get_card_base_list}/ $$

* v1 版本号
* customer 模块名 客管家
* member 子模块名 会员管理 (子模块可以有多级,无层数限制)
* get_card_base_list 业务名 获取所有的会员列表

#### 提交请求

拼接方式为: 版本号/app名/模块名/业务名.以下图为例:
	$$ \text{/v1/customer/member/update_user_info}/<id> $$

* v1 版本号
* customer 模块名 客管家
* member 子模块名 会员管理 (子模块可以有多级,无层数限制)
* update_user_info 业务名 更新用户信息
* <id>  对象id.  也就是待更新的用户的id.

> 更新的字段内容请以json的方式提交.

#### 谓词的使用

在业务名命名方面.推荐的方法是 谓词 或者 谓词 + 宾语 的方式

* add  新增一个对象 (新增一个用户.../user/add或者.../user/add_one等等)
* update 编辑一个对象
* remove 删除一个对象
* list  查询多个对象,(查询一组用户信息 ../user/info_list)

> 根据业务需求, 可以扩展此谓词库

#### 补充说明

* 理论上对url段数的**没有限制**.但建议尽量简短,望文生义.
* 如果需要在url上拼接id的话,**id**必须是整数.而且必须**放在**路由**地址的最后一段**.如果你的id不是整数类型.请使用args来传递参数.

### 请求参数

* 所有的请求中不需要携带

* hotel_group_id 集团id
* hotel_id，酒店id
* create_user 创建者id
* modify_user 修改者id

这些参数.这些参数可以通过认证函数的返回值补充数据.详情请查看authorization接口的调用说明.

### 返回参数

返回参数为json格式的字典数据. 其包含的内容如下

字段名| 中文名| 是否必须|说明
:--:|:--:|:--:|:--:
message| 状态消息| 必须| 字符串格式.当message为success时,表示请求成功.否则message携带的是出错信息
data|数据载体|非必须|字典或者数组格式.如果返回体中包含数据.则必须放在一个key名称为data的键值对对象中.复杂的返回体请组织成字典格式放入data中

> 以上为返回约定. 只要不违反上述约定,可以根据需求自行扩展返回体字段.

* 所有的返回参数不要携带hotel_group_id，hotel_id
* 不要人为修改服务器的返回代码.所有返回逻辑成功的响应的返回状态码为200即可

### 其它约定

本段内容是在相关接口文档未进行说明时的惯例和标准. 在和其它接口文档的本身的约定冲突时,以接口文档本身的定义为准

* 字符集UTF-8
* 接口至少支持GET/POST方法
* CORS(Cross-Origin Resource Sharing) 跨域问题由后端处理
* 跳转问题由前端处理
* 请求体和返回体中使用1/0(字符串)替代True/False(布尔类型)
* 请求头参数名小写,如需要使用连字符号,请使用"-"而不是"_"
* 身份信息使用请求头(request.headers)中的authorization(小写)参数验证.(详细验证方法见后继文档)
* 开发环境可以使用http协议.生产环境使用https协议

