# 查询接口

## 一般约定

* 数字在传输中可能被包装成字符串字符串.
* 字符集为UTF-8
* 示范代码和返回值中的空格仅仅是语法格式(PEP8).并不是有效的信息载体.请自行去除空白/空字符.

## 服务器信息

* 主机 47.99.105.196
* tcp服务端口  32000
* http服务端口 7012

## 接口定义

1. 查询条码
2. 申请空白条码
3. 替换条码
4. 回传作业文件

### 查询条码

#### 定义

查询条码相关信息

* 协议 tcp
* 端口 32000
* 请求参数  字符串,格式为: "CheckTraceCodeCanUse," + code (逗号和条码之间有无空格不重要,系统会自动去除)
* 返回值 字符串,格式为: code + "," + 状态位 (逗号和条码之间可能有空格,请自行去除)

#### 行为

服务器在接收到条码信息后会根据条码查询数据库.并返回查询的结果.

#### 状态位定义

* 系统检测条码合格返回数据格式: code,1
* 系统检测条码重复返回数据格式: code,2
* 系统检测条码非当前生产数据格式: code,3
* 系统检测条码格式错误: code,4

#### Example

```python3
client = TCPClient()
client.connect("47.99.105.196:32000")
client.send("CheckTraceCodeCanUse, 10401911001201805011536541033317")
result = client.revice()
print(result)
>> 10401911001201805011536541033317, 1    // 状态位1,标识可用.
```

### 条码重置

#### 定义

重置条码相关信息

* 协议 tcp
* 端口 32000
* 请求参数  字符串,格式为: "reset_code," + code (逗号和条码之间有无空格不重要,系统会自动去除)
* 返回值 字符串,格式为: code + "," + 状态位 (逗号和条码之间可能有空格,请自行去除)

#### 行为

服务器在接收到条码信息后会重置对应条码的状态信息.恢复到使用之前的状态.

#### 状态位

* 返回值1. 表示重置成功
* 返回值0. 表示此条码处于未使用状态.无需重置.
* 返回值2.  表示此条码不存在
* 返回值3.  表示此条码尚未打印

#### Example

```python3
client = TCPClient()
client.connect("47.99.105.196:32000")
client.send("reset_code, 10401911001201805011536541033317")
result = client.revice()
print(result)
>> 10401911001201805011536541033317, 1    // 状态位1,重置成功.
```

### 条码申请

#### 定义

临时申请一个条码(用作箱码等)

* 协议 tcp
* 端口 32000
* 请求参数  字符串,格式为: "apply_code," + example_code (逗号和条码之间有无空格不重要,系统会自动去除)
  * 参数example_code是一个已使用的条码信息(比如上一个已使用的条码信息).系统会根据example_code所关联的产品,申请一个关联相同产品的可用条码.
* 返回值 字符串,
  * 服务器响应正确,直接返回一个条码信息
  * 否则会返回状态位提示错误信息

#### 行为

服务器在接收到申请后,先根据example_code的值查询其对应的产品信息.然后申请一个空白条码,设置其关联的产品和example_code关联的产品一致.然后返回这个空白条码.

#### 状态位

* 返回值1. 表示example_code无效
* 返回值0. 表示空白条码已用尽.
* 返回值-1.  表示程序出错

#### Example

```python3
client = TCPClient()
client.connect("47.99.105.196:32000")
client.send("apply_code, 10401911001201805011536541033317")
result = client.revice()
print(result)
>> 23132100917116379735071455644638667   // 申请到了一个新条码.
```